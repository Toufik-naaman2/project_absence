{% extends 'base.html' %}

{% block title %}Teacher Dashboard{% endblock %}
{% block title_header %}Academic Overview{% endblock %}

{% block content %}
<style>
    /* Minimalist Dashboard Styling */
    .stat-box {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        transition: border-color 0.2s;
    }

    .stat-box:hover {
        border-color: #2563eb;
    }

    .stat-label {
        font-size: 0.75rem;
        font-weight: 700;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 8px;
        display: block;
    }

    .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #111827;
    }

    .course-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        transition: all 0.2s ease;
    }

    .course-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }

    .chart-container {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
    }

    .action-btn {
        border-radius: 8px;
        padding: 12px 20px;
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s;
    }

    .btn-manage { background-color: #111827; color: white; border: none; }
    .btn-manage:hover { background-color: #1f2937; color: white; }
    
    .btn-export { background-color: #ffffff; color: #374151; border: 1px solid #d1d5db; }
    .btn-export:hover { background-color: #f9fafb; }
</style>

<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="stat-box">
            <span class="stat-label">Active Modules</span>
            <div class="stat-value">{{ courses.count }}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-box">
            <span class="stat-label">Total Attendance</span>
            <div class="stat-value">{{ total_checkins }}</div>
        </div>
    </div>
</div>

<div class="row g-4 mb-5">
    <div class="col-lg-8">
        <div class="chart-container h-100">
            <h5 class="fw-bold mb-4" style="font-size: 1rem;">Attendance Distribution</h5>
            <div style="position: relative; height: 300px;">
                <canvas id="teacherChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="chart-container h-100">
            <h5 class="fw-bold mb-4" style="font-size: 1rem;">Quick Actions</h5>
            <div class="d-grid gap-2">
                <a href="{% url 'session_list' %}" class="action-btn btn-manage justify-content-center">
                    <i class="bi bi-plus-circle"></i> Manage Sessions
                </a>
                <a href="{% url 'export_attendance_csv' %}" class="action-btn btn-export justify-content-center">
                    <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV Report
                </a>
                <a href="{% url 'export_attendance_pdf' %}" class="action-btn btn-export justify-content-center text-danger">
                    <i class="bi bi-file-earmark-pdf"></i> Export PDF Report
                </a>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0" style="font-size: 1.25rem;">My Assigned Courses</h4>
    <span class="text-muted small">Semester 1, 2026</span>
</div>

<div class="row g-4">
    {% for course in courses %}
    <div class="col-md-4">
        <div class="course-card p-4">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <span class="badge bg-light text-dark border px-2 py-1 fw-medium" style="font-size: 0.7rem;">
                    {{ course.class_obj.name|default:"General Class" }}
                </span>
                <i class="bi bi-three-dots-vertical text-muted"></i>
            </div>
            
            <h5 class="fw-bold mb-1" style="font-size: 1.1rem; color: #111827;">{{ course.module.name }}</h5>
            <p class="text-muted small mb-4">Class: {{ course.class_obj.name|default:"Not Assigned" }}</p>
            
            <hr class="my-3 opacity-10">
            
            <a href="{% url 'session_list' %}?classmodule_id={{ course.id }}" 
               class="text-primary text-decoration-none small fw-semibold d-flex align-items-center gap-1">
                View Sessions <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <div class="text-muted border rounded-3 p-5 border-dashed">
            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
            No courses assigned to your profile yet.
        </div>
    </div>
    {% endfor %}
</div>

<script>
    const ctx = document.getElementById('teacherChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar', // غيرت الـ Doughnut لـ Bar لأنه أكثر احترافية للبيانات الأكاديمية
        data: {
            labels: {{ chart_labels|safe }},
            datasets: [{
                label: 'Attendance Count',
                data: {{ chart_data|safe }},
                backgroundColor: '#2563eb',
                borderRadius: 6,
                barThickness: 25
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                x: { grid: { display: false } }
            }
        }
    });
</script>
{% endblock %}